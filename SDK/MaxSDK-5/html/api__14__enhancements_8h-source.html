<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
		<title>Max5 API Reference</title>
		<link href="c74-doxygen.css" rel="stylesheet" type="text/css">
	</head>
	<body>

		<div id="c74header">
			<img src="max5.png" />
			<p>Max 5 API Reference</p>
		</div>

<!-- Generated by Doxygen 1.5.6 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>api_14_enhancements.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/** </span>
<a name="l00002"></a>00002 <span class="comment">    @page chapter_enhancements Enhancements to Objects</span>
<a name="l00003"></a>00003 <span class="comment"></span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">    @section chapter_enhancements_presets Preset Support</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">    Presets are a simple state-saving mechanism. Your object receives a preset message when state is being saved. You respond by creating a message that will be sent back to your object when the preset is recalled.</span>
<a name="l00008"></a>00008 <span class="comment"></span>
<a name="l00009"></a>00009 <span class="comment">    For more powerful and general state-saving, use the pattr system described below. </span>
<a name="l00010"></a>00010 <span class="comment"></span>
<a name="l00011"></a>00011 <span class="comment">    To support saving a single integer in a preset, you can use the preset_int() convenience function. The preset_int() function records an int message with the value you pass it in the preset, to be sent back to your object at a later time.</span>
<a name="l00012"></a>00012 <span class="comment"></span>
<a name="l00013"></a>00013 <span class="comment">@code</span>
<a name="l00014"></a>00014 <span class="comment">    class_addmethod(c, (method)myobject_preset, "preset", A_CANT, 0);</span>
<a name="l00015"></a>00015 <span class="comment"></span>
<a name="l00016"></a>00016 <span class="comment">    void myobject_preset(t_myobject *x)</span>
<a name="l00017"></a>00017 <span class="comment">    {</span>
<a name="l00018"></a>00018 <span class="comment">        preset_int(x, x-&gt;m_currentvalue);</span>
<a name="l00019"></a>00019 <span class="comment">    }</span>
<a name="l00020"></a>00020 <span class="comment">@endcode</span>
<a name="l00021"></a>00021 <span class="comment"></span>
<a name="l00022"></a>00022 <span class="comment">    More generally, you can use preset_store(). Here is an example of storing two values (m_xvalue and m_yvalue) in a list.</span>
<a name="l00023"></a>00023 <span class="comment">@code</span>
<a name="l00024"></a>00024 <span class="comment">        preset_store("ossll", x, ob_sym(x), gensym("list"), x-&gt;m_xvalue, x-&gt;m_yvalue);</span>
<a name="l00025"></a>00025 <span class="comment">@endcode</span>
<a name="l00026"></a>00026 <span class="comment"></span>
<a name="l00027"></a>00027 <span class="comment"></span>
<a name="l00028"></a>00028 <span class="comment">    @section chapter_enhancements_assistance Assistance</span>
<a name="l00029"></a>00029 <span class="comment"></span>
<a name="l00030"></a>00030 <span class="comment">    To show descriptions of your object's inlets and outlets while editing a patcher, your object can respond to the assist message with a function that copies the text to a string.</span>
<a name="l00031"></a>00031 <span class="comment"></span>
<a name="l00032"></a>00032 <span class="comment">@code</span>
<a name="l00033"></a>00033 <span class="comment">    class_addmethod(c, (method)myobject_assist, "assist", A_CANT, 0);</span>
<a name="l00034"></a>00034 <span class="comment">@endcode</span>
<a name="l00035"></a>00035 <span class="comment"></span>
<a name="l00036"></a>00036 <span class="comment">    The function below has two inlets and one outlet. The io argument will be 1 for inlets, 2 for outlets. The index argument will be 0 for the leftmost inlet or outlet. You can copy a maximum of 512 characters to the output string s. You can use strncpy_zero() to copy the string, or if you want to format the assistance string based on a current value in the object, you could use snprintf_zero().</span>
<a name="l00037"></a>00037 <span class="comment"></span>
<a name="l00038"></a>00038 <span class="comment">@code</span>
<a name="l00039"></a>00039 <span class="comment">    void myobject_assist(t_myobject *x, void *b, long io, long index, char *s)</span>
<a name="l00040"></a>00040 <span class="comment">    {</span>
<a name="l00041"></a>00041 <span class="comment">        switch (io) {</span>
<a name="l00042"></a>00042 <span class="comment">            case 1: </span>
<a name="l00043"></a>00043 <span class="comment">                switch (index) {</span>
<a name="l00044"></a>00044 <span class="comment">                    case 0:</span>
<a name="l00045"></a>00045 <span class="comment">                        strncpy_zero(s, "This is a description of the leftmost inlet", 512);</span>
<a name="l00046"></a>00046 <span class="comment">                        break;</span>
<a name="l00047"></a>00047 <span class="comment">                    case 1: </span>
<a name="l00048"></a>00048 <span class="comment">                        strncpy_zero(s, "This is a description of the rightmost inlet", 512);</span>
<a name="l00049"></a>00049 <span class="comment">                        break;</span>
<a name="l00050"></a>00050 <span class="comment">                }</span>
<a name="l00051"></a>00051 <span class="comment">                break;</span>
<a name="l00052"></a>00052 <span class="comment">            case 2:</span>
<a name="l00053"></a>00053 <span class="comment">                strncpy_zero(s, "This is a description of the outlet", 512);</span>
<a name="l00054"></a>00054 <span class="comment">                break;</span>
<a name="l00055"></a>00055 <span class="comment">        }</span>
<a name="l00056"></a>00056 <span class="comment">    }</span>
<a name="l00057"></a>00057 <span class="comment">@endcode</span>
<a name="l00058"></a>00058 <span class="comment"></span>
<a name="l00059"></a>00059 <span class="comment"></span>
<a name="l00060"></a>00060 <span class="comment">    @section chapter_enhancements_hotness Hot and Cold Inlets</span>
<a name="l00061"></a>00061 <span class="comment"></span>
<a name="l00062"></a>00062 <span class="comment">    Objects such as operators (+, -, etc.) and the int object have inlets that merely store values rather than performing an operation and producing output. These inlets are labeled with a blue color to indicate they are "cold" rather than action-producing "hot" inlets. To implement this labeling, your object can respond to the inletinfo message.</span>
<a name="l00063"></a>00063 <span class="comment"></span>
<a name="l00064"></a>00064 <span class="comment">@code</span>
<a name="l00065"></a>00065 <span class="comment">        class_addmethod(c, (method)myobject_inletinfo, "inletinfo", A_CANT, 0);</span>
<a name="l00066"></a>00066 <span class="comment">@endcode</span>
<a name="l00067"></a>00067 <span class="comment"></span>
<a name="l00068"></a>00068 <span class="comment">    If all of your object's non-left inlets are "cold" you can use the function stdinletinfo() instead of writing your own, as shown below:</span>
<a name="l00069"></a>00069 <span class="comment">@code</span>
<a name="l00070"></a>00070 <span class="comment">        class_addmethod(c, (method)stdinletinfo, "inletinfo", A_CANT, 0);</span>
<a name="l00071"></a>00071 <span class="comment">@endcode</span>
<a name="l00072"></a>00072 <span class="comment"></span>
<a name="l00073"></a>00073 <span class="comment">    To write your own function, just look at the index argument (which is 0 for the left inlet). This example turns the third inlet cold. You don't need to do anything for "hot" inlets.</span>
<a name="l00074"></a>00074 <span class="comment"></span>
<a name="l00075"></a>00075 <span class="comment">@code</span>
<a name="l00076"></a>00076 <span class="comment">    void myobject_inletinfo(t_myobject *x, void *b, long index, char *t)</span>
<a name="l00077"></a>00077 <span class="comment">    {</span>
<a name="l00078"></a>00078 <span class="comment">        if (index == 2)</span>
<a name="l00079"></a>00079 <span class="comment">            *t = 1;</span>
<a name="l00080"></a>00080 <span class="comment">    }</span>
<a name="l00081"></a>00081 <span class="comment">@endcode</span>
<a name="l00082"></a>00082 <span class="comment"></span>
<a name="l00083"></a>00083 <span class="comment"></span>
<a name="l00084"></a>00084 <span class="comment">    @section chapter_enhancements_ed Showing a Text Editor</span>
<a name="l00085"></a>00085 <span class="comment"></span>
<a name="l00086"></a>00086 <span class="comment">    Objects such as coll and text display a text editor window when you double-click. Users can edit the contents of the objects and save the updated data (or not). Here's how to do the same thing in your object.</span>
<a name="l00087"></a>00087 <span class="comment"></span>
<a name="l00088"></a>00088 <span class="comment">    First, if you want to support double-clicking on a non-UI object, you can respond to the dblclick message.</span>
<a name="l00089"></a>00089 <span class="comment"></span>
<a name="l00090"></a>00090 <span class="comment">@code</span>
<a name="l00091"></a>00091 <span class="comment">    class_addmethod(c, (method)myobject_dblclick, "dblclick", A_CANT, 0);</span>
<a name="l00092"></a>00092 <span class="comment"></span>
<a name="l00093"></a>00093 <span class="comment">    void myobject_dblclick(t_myobject *x)</span>
<a name="l00094"></a>00094 <span class="comment">    {</span>
<a name="l00095"></a>00095 <span class="comment">        // open editor here</span>
<a name="l00096"></a>00096 <span class="comment">    }</span>
<a name="l00097"></a>00097 <span class="comment">@endcode</span>
<a name="l00098"></a>00098 <span class="comment"></span>
<a name="l00099"></a>00099 <span class="comment">    You'll need to add a #t_object pointer to your object's data structure to hold the editor.</span>
<a name="l00100"></a>00100 <span class="comment"></span>
<a name="l00101"></a>00101 <span class="comment">@code</span>
<a name="l00102"></a>00102 <span class="comment">    typedef struct _myobject</span>
<a name="l00103"></a>00103 <span class="comment">    {</span>
<a name="l00104"></a>00104 <span class="comment">        t_object m_obj;</span>
<a name="l00105"></a>00105 <span class="comment">        t_object *m_editor;</span>
<a name="l00106"></a>00106 <span class="comment">    } t_myobject;</span>
<a name="l00107"></a>00107 <span class="comment">@endcode</span>
<a name="l00108"></a>00108 <span class="comment"></span>
<a name="l00109"></a>00109 <span class="comment">    Initialize the m_editor field to NULL in your new instance routine. Then implement the dblclick method as follows:</span>
<a name="l00110"></a>00110 <span class="comment">@code</span>
<a name="l00111"></a>00111 <span class="comment">        if (x-&gt;m_editor)</span>
<a name="l00112"></a>00112 <span class="comment">            x-&gt;m_editor = object_new(CLASS_NOBOX, gensym("jed"), (t_object *)x, 0);</span>
<a name="l00113"></a>00113 <span class="comment">        else</span>
<a name="l00114"></a>00114 <span class="comment">            object_attr_setchar(x-&gt;m_editor, gensym("visible"), 1);</span>
<a name="l00115"></a>00115 <span class="comment">@endcode</span>
<a name="l00116"></a>00116 <span class="comment"></span>
<a name="l00117"></a>00117 <span class="comment">    The code above does the following: If the editor does not exist, we create one by making a "jed" object and passing our object as an argument. This permits the editor to tell our object when the window is closed.</span>
<a name="l00118"></a>00118 <span class="comment"></span>
<a name="l00119"></a>00119 <span class="comment">    If the editor does exist, we set its visible attribute to 1, which brings the text editor window to the front.</span>
<a name="l00120"></a>00120 <span class="comment"></span>
<a name="l00121"></a>00121 <span class="comment">    To set the text of the edit window, we can send our jed object the settext message with a zero-terminated buffer of text. We also provide a symbol specifying how the text is encoded. For best results, the text should be encoded as UTF-8. Here is an example where we set a string to contain "Some text to edit" then pass it to the editor.</span>
<a name="l00122"></a>00122 <span class="comment"></span>
<a name="l00123"></a>00123 <span class="comment">@code</span>
<a name="l00124"></a>00124 <span class="comment">            char text[512];</span>
<a name="l00125"></a>00125 <span class="comment"></span>
<a name="l00126"></a>00126 <span class="comment">            strcpy(text,"Some text to edit");</span>
<a name="l00127"></a>00127 <span class="comment">            object_method(x-&gt;m_editor, gensym("settext"), text, gensym("utf-8")); </span>
<a name="l00128"></a>00128 <span class="comment">@endcode</span>
<a name="l00129"></a>00129 <span class="comment"></span>
<a name="l00130"></a>00130 <span class="comment">    The title attribute sets the window title of the text editor.</span>
<a name="l00131"></a>00131 <span class="comment">@code</span>
<a name="l00132"></a>00132 <span class="comment">            object_attr_setsym(x-&gt;m_editor, gensym("title"), gensym("crazytext"));</span>
<a name="l00133"></a>00133 <span class="comment">@endcode</span>
<a name="l00134"></a>00134 <span class="comment"></span>
<a name="l00135"></a>00135 <span class="comment">    When the user closes the text window, your object (or the object you passed as an argument when creating the editor) will be sent the edclose message.</span>
<a name="l00136"></a>00136 <span class="comment">@code</span>
<a name="l00137"></a>00137 <span class="comment">            class_addmethod(c, (method)myobject_edclose, "edclose", A_CANT, 0);</span>
<a name="l00138"></a>00138 <span class="comment">@endcode</span>
<a name="l00139"></a>00139 <span class="comment"></span>
<a name="l00140"></a>00140 <span class="comment">    The edclose method is responsible for doing something with the text. It should also zero the reference to the editor stored in the object, because it will be freed. A pointer to the text pointer is passed, along with its size. The encoding of the text is always UTF-8.</span>
<a name="l00141"></a>00141 <span class="comment"></span>
<a name="l00142"></a>00142 <span class="comment">@code</span>
<a name="l00143"></a>00143 <span class="comment">    void myobject_edclose(t_myobject *x, char **ht, long size)</span>
<a name="l00144"></a>00144 <span class="comment">    {</span>
<a name="l00145"></a>00145 <span class="comment">        // do something with the text</span>
<a name="l00146"></a>00146 <span class="comment">        x-&gt;m_editor = NULL;</span>
<a name="l00147"></a>00147 <span class="comment">    }</span>
<a name="l00148"></a>00148 <span class="comment">@endcode</span>
<a name="l00149"></a>00149 <span class="comment"></span>
<a name="l00150"></a>00150 <span class="comment">    If your object will be showing the contents of a text file, you are still responsible for setting the initial text, but you can assign a file so that the editor will save the text data when the user chooses Save from the File menu. To assign a file, use the filename message, assuming you have a filename and path ID.</span>
<a name="l00151"></a>00151 <span class="comment"></span>
<a name="l00152"></a>00152 <span class="comment">@code</span>
<a name="l00153"></a>00153 <span class="comment">        object_method(x-&gt;m_editor, gensym("filename"), x-&gt;m_myfilename, x-&gt;m_mypath);</span>
<a name="l00154"></a>00154 <span class="comment">@endcode</span>
<a name="l00155"></a>00155 <span class="comment"></span>
<a name="l00156"></a>00156 <span class="comment">    The filename message will set the title of the text editor window, but you can use the title attribute to override the simple filename. For example, you might want the name of your object to precede the filename:</span>
<a name="l00157"></a>00157 <span class="comment">@code</span>
<a name="l00158"></a>00158 <span class="comment">        char titlename[512];</span>
<a name="l00159"></a>00159 <span class="comment"></span>
<a name="l00160"></a>00160 <span class="comment">        sprintf(titlename, "myobject: %s", x-&gt;m_myfilename);</span>
<a name="l00161"></a>00161 <span class="comment">        object_attr_setsym(x-&gt;m_editor, gensym("title"), gensym(titlename));</span>
<a name="l00162"></a>00162 <span class="comment">@endcode</span>
<a name="l00163"></a>00163 <span class="comment"></span>
<a name="l00164"></a>00164 <span class="comment">    Each time the user chooses Save, your object will receive an edsave message. If you return zero from your edsave method, the editor will proceed with saving the text in a file. If you return non-zero, the editor assumes you have taken care of saving the text. The general idea is that when the user wants to save the text, it is either updated inside your object, updated in a file, or both. As an example, the js object uses its edsave message to trigger a recompile of the Javascript code. But it also returns 0 from its edsave method so that the text editor will update the script file. Except for the return value, the prototype of the edsave method is identical to the edclose method.</span>
<a name="l00165"></a>00165 <span class="comment"></span>
<a name="l00166"></a>00166 <span class="comment">@code</span>
<a name="l00167"></a>00167 <span class="comment">    class_addmethod(c, (method)myobject_edsave, "edsave", A_CANT, 0);</span>
<a name="l00168"></a>00168 <span class="comment"></span>
<a name="l00169"></a>00169 <span class="comment">    long myobject_edsave(t_myobject *x, char **ht, long size)</span>
<a name="l00170"></a>00170 <span class="comment">    {</span>
<a name="l00171"></a>00171 <span class="comment">        // do something with the text</span>
<a name="l00172"></a>00172 <span class="comment">        return 0;       // tell editor it can save the text</span>
<a name="l00173"></a>00173 <span class="comment">    }</span>
<a name="l00174"></a>00174 <span class="comment">@endcode</span>
<a name="l00175"></a>00175 <span class="comment"></span>
<a name="l00176"></a>00176 <span class="comment"></span>
<a name="l00177"></a>00177 <span class="comment">    @section chapter_enhancements_tables Accessing Data in table Objects</span>
<a name="l00178"></a>00178 <span class="comment"></span>
<a name="l00179"></a>00179 <span class="comment">    Table objects can be given names as arguments. If a table object has a name, you can access the data using table_get(). Supply a symbol, as well as a place to assign a pointer to the data and the length. The following example accesses a table called foo, and, if found, posts all its values.</span>
<a name="l00180"></a>00180 <span class="comment"></span>
<a name="l00181"></a>00181 <span class="comment">@code</span>
<a name="l00182"></a>00182 <span class="comment">    long **data = NULL;</span>
<a name="l00183"></a>00183 <span class="comment">    long i, size;</span>
<a name="l00184"></a>00184 <span class="comment"></span>
<a name="l00185"></a>00185 <span class="comment">        if (!table_get(gensym("foo"), &amp;data, &amp;size)) {</span>
<a name="l00186"></a>00186 <span class="comment">            for (i = 0;  i &lt; size; i++) {</span>
<a name="l00187"></a>00187 <span class="comment">                post("%ld: %ld",i,(*data)[i]);</span>
<a name="l00188"></a>00188 <span class="comment">            }</span>
<a name="l00189"></a>00189 <span class="comment">        }</span>
<a name="l00190"></a>00190 <span class="comment">@endcode</span>
<a name="l00191"></a>00191 <span class="comment"></span>
<a name="l00192"></a>00192 <span class="comment">    You can also write data into the table. If you would like the table editor to redraw after doing so, use table_dirty(). Here's an example where we set all values in the table to zero, then notify the table to redraw.</span>
<a name="l00193"></a>00193 <span class="comment"></span>
<a name="l00194"></a>00194 <span class="comment">@code</span>
<a name="l00195"></a>00195 <span class="comment">    long **data = NULL;</span>
<a name="l00196"></a>00196 <span class="comment">    long i, size;</span>
<a name="l00197"></a>00197 <span class="comment"></span>
<a name="l00198"></a>00198 <span class="comment">        if (!table_get(gensym("foo"), &amp;data, &amp;size)) {</span>
<a name="l00199"></a>00199 <span class="comment">            for (i = 0;  i &lt; size; i++) {</span>
<a name="l00200"></a>00200 <span class="comment">                (*data)[i]  = 0;</span>
<a name="l00201"></a>00201 <span class="comment">            }</span>
<a name="l00202"></a>00202 <span class="comment">            table_dirty(gensym("foo"));</span>
<a name="l00203"></a>00203 <span class="comment">        }</span>
<a name="l00204"></a>00204 <span class="comment">@endcode</span>
<a name="l00205"></a>00205 <span class="comment"></span>
<a name="l00206"></a>00206 <span class="comment"></span>
<a name="l00207"></a>00207 <span class="comment">    buffer~ support</span>
<a name="l00208"></a>00208 <span class="comment"></span>
<a name="l00209"></a>00209 <span class="comment"></span>
<a name="l00210"></a>00210 <span class="comment">*/</span>
</pre></div></div>
		<div id="c74footer">
			<p>Copyright &copy; 2008, <a href="http://www.cycling74.com/">Cycling '74</a></p>
		</div>
	</body>
</html>
