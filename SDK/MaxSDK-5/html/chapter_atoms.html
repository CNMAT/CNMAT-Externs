<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
		<title>Max5 API Reference</title>
		<link href="c74-doxygen.css" rel="stylesheet" type="text/css">
	</head>
	<body>

		<div id="c74header">
			<img src="max5.png" />
			<p>Max 5 API Reference</p>
		</div>

<!-- Generated by Doxygen 1.5.6 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="chapter_atoms">Atoms and Messages </a></h1>When a Max object receives a message, it uses its class to look up the message selector ("int", "bang", "set" etc.<p>
) and invoke the associated C function (method). This association is what you are creating when you use <a class="el" href="group__class.html#g1fabf54e0cec8d4e5f732fa347b3f874" title="Adds a method to a previously defined object class.">class_addmethod()</a> in the initialization routine. If the lookup fails, you'll see an "object doesn't understand message" error in the Max window.<p>
Message selectors are not character strings, but a special data structure called a symbol (<a class="el" href="structt__symbol.html" title="The symbol.">t_symbol</a>). A symbol holds a string and a value, but what is more important is that every symbol in Max is unique. This permits you to compare two symbols for equivalence by comparing pointers, rather than having to compare each character in two strings.<p>
The "data" or argument part of a message, if it exists, is transmitted in the form of an array of atoms (<a class="el" href="structt__atom.html" title="An atom is a typed datum.">t_atom</a>). The atom is a structure that can hold integers, floats, symbols, or even pointers to other objects, identified by a tag. You'll use symbols and atoms both in sending messages and receiving them.<p>
To illustrate the use of symbols and atoms, here is how you would send a message out an outlet. Let's say we want to send the message "green 43 crazy 8.34." This message consists of a selector "green" plus an array of three atoms.<p>
First, we'll need to create a generic outlet with outlet_new in our new instance routine. <div class="fragment"><pre class="fragment">        x-&gt;m_outlet = <a class="code" href="group__inout.html#g451b3a1ec203ac8648a5399e209f070a" title="Use outlet_new() to create an outlet that can send a specific non-standard message...">outlet_new</a>((<a class="code" href="structt__object.html" title="The structure for the head of any object which wants to have inlets or outlets, or...">t_object</a> *)x, NULL);
</pre></div><p>
The second argument being NULL indicates that the outlet can be used to send any message. If the second argument had been a character string such as "int" or "set" only that specific message could be sent out the outlet. You'd be correct if you wondered whether <a class="el" href="group__inout.html#g9b8d897c728eeafa5638d4fc16ff704e" title="Use intout() to create an outlet that will always send the int message.">intout()</a> is actually just outlet_new(x, "int").<p>
Now that we have our generic outlet, we'll call <a class="el" href="group__inout.html#g12798ee897e01dac21ee547c4091d8a8" title="Use outlet_anything() to send any message out an outlet.">outlet_anything()</a> on it in a method. The first step, however, is to assemble our message, with a selector "green" plus an array of atoms. Assigning ints and floats to an atom is relatively simple, but to assign a symbol, we need to transform a character string into a symbol using <a class="el" href="group__symbol.html#g8268797d125a15bae1010af70b559e05" title="Given a C-string, fetch the matching t_symbol pointer from the symbol table, generating...">gensym()</a>. The <a class="el" href="group__symbol.html#g8268797d125a15bae1010af70b559e05" title="Given a C-string, fetch the matching t_symbol pointer from the symbol table, generating...">gensym()</a> function returns a pointer to a symbol that is guaranteed to be unique for the string you supply. This means the string is compared with other symbols to ensure its uniqueness. If it already exists, <a class="el" href="group__symbol.html#g8268797d125a15bae1010af70b559e05" title="Given a C-string, fetch the matching t_symbol pointer from the symbol table, generating...">gensym()</a> will supply a pointer to the symbol. Otherwise it will create a new one and store it in a table so it can be found the next time someone asks for it.<p>
<div class="fragment"><pre class="fragment">    <span class="keywordtype">void</span> myobject_bang(<a class="code" href="structt__object.html" title="The structure for the head of any object which wants to have inlets or outlets, or...">t_object</a> *x)
    {
        <a class="code" href="structt__atom.html" title="An atom is a typed datum.">t_atom</a> argv[3];

        <a class="code" href="group__atom.html#g98af493b18dfac0f8d441e16e520d5f6" title="Inserts an integer into a t_atom and change the t_atom&amp;#39;s type to A_LONG.">atom_setlong</a>(argv, 43);
        <a class="code" href="group__atom.html#g36c2619378802011ff0ff44bf74a807c" title="Inserts a t_symbol * into a t_atom and change the t_atom&amp;#39;s type to A_SYM.">atom_setsym</a>(argv + 1, <a class="code" href="group__symbol.html#g8268797d125a15bae1010af70b559e05" title="Given a C-string, fetch the matching t_symbol pointer from the symbol table, generating...">gensym</a>(<span class="stringliteral">"crazy"</span>));
        <a class="code" href="group__atom.html#ge4faf28f99370e1a4ae9eab7df5bede7" title="Inserts a floating point number into a t_atom and change the t_atom&amp;#39;s type to...">atom_setfloat</a>(argv + 2, 8.34);

        <a class="code" href="group__inout.html#g12798ee897e01dac21ee547c4091d8a8" title="Use outlet_anything() to send any message out an outlet.">outlet_anything</a>(x-&gt;m_outlet, <a class="code" href="group__symbol.html#g8268797d125a15bae1010af70b559e05" title="Given a C-string, fetch the matching t_symbol pointer from the symbol table, generating...">gensym</a>(<span class="stringliteral">"green"</span>), 3, argv);
    }
</pre></div><p>
In the call to <a class="el" href="group__inout.html#g12798ee897e01dac21ee547c4091d8a8" title="Use outlet_anything() to send any message out an outlet.">outlet_anything()</a> above, gensym("green") represents the message selector. The <a class="el" href="group__inout.html#g12798ee897e01dac21ee547c4091d8a8" title="Use outlet_anything() to send any message out an outlet.">outlet_anything()</a> function will try to find a message "green" in each of the objects connected to the inlet. If <a class="el" href="group__inout.html#g12798ee897e01dac21ee547c4091d8a8" title="Use outlet_anything() to send any message out an outlet.">outlet_anything()</a> finds such a message, it will execute it, passing it the array of atoms it received.<p>
If it cannot find a match for the symbol green, it does one more thing, which allows objects to handle messages generically. Your object can define a special method bound to the symbol "anything" that will be invoked if no other match is found for a selector. We'll discuss the anything method in a moment, but first, we need to return to <a class="el" href="group__class.html#g1fabf54e0cec8d4e5f732fa347b3f874" title="Adds a method to a previously defined object class.">class_addmethod()</a> and explain the final arguments it accepts.<p>
To access atoms, you can use the functions <a class="el" href="group__atom.html#g98af493b18dfac0f8d441e16e520d5f6" title="Inserts an integer into a t_atom and change the t_atom&#39;s type to A_LONG.">atom_setlong()</a>, <a class="el" href="group__atom.html#g62c0a631f50db54ec654a9e40b992fe2" title="Retrieves a long integer value from a t_atom.">atom_getlong()</a> etc. or you can access the <a class="el" href="structt__atom.html" title="An atom is a typed datum.">t_atom</a> structure directly. We recommend using the accessor functions, as they lead to both cleaner code and will permit your source to work without modifications when changes to the <a class="el" href="structt__atom.html" title="An atom is a typed datum.">t_atom</a> structure occur over time.<h2><a class="anchor" name="chapter_atoms_types">
Argument Type Specifiers</a></h2>
In the simp example, you saw the int method defined as follows: <div class="fragment"><pre class="fragment">        <a class="code" href="group__class.html#g1fabf54e0cec8d4e5f732fa347b3f874" title="Adds a method to a previously defined object class.">class_addmethod</a>(c, (<a class="code" href="group__datatypes.html#gc26ba0a173b50597f5738132e059b42d" title="Function pointer type for generic methods.">method</a>)simp_int, <a class="code" href="group__atom.html#gg8aa6700e9f00b132eb376db6e39ade47002f28879581a6f66ea492b994b96f1e" title="long integer">A_LONG</a>, 0);
</pre></div><p>
The <a class="el" href="group__atom.html#gg8aa6700e9f00b132eb376db6e39ade47002f28879581a6f66ea492b994b96f1e" title="long integer">A_LONG</a>, 0 arguments to <a class="el" href="group__class.html#g1fabf54e0cec8d4e5f732fa347b3f874" title="Adds a method to a previously defined object class.">class_addmethod()</a> specify the type of arguments expected by the C function you have written. <a class="el" href="group__atom.html#gg8aa6700e9f00b132eb376db6e39ade47002f28879581a6f66ea492b994b96f1e" title="long integer">A_LONG</a> means that the C function accepts a long integer argument. The 0 terminates the argument specifier list, so for the int message, there is a single long integer argument.<p>
The other options are <a class="el" href="group__atom.html#gg8aa6700e9f00b132eb376db6e39ade470b3aa0ab8104573dfc9cb70b5b08031f" title="32-bit float">A_FLOAT</a> for doubles, <a class="el" href="group__atom.html#gg8aa6700e9f00b132eb376db6e39ade472d661c2a5d949566e2f1944c99bceeea" title="t_symbol pointer">A_SYM</a> for symbols, and <a class="el" href="group__atom.html#gg8aa6700e9f00b132eb376db6e39ade4781c1a8550f038db16a619167a70a79b6" title="request that args be passed as an array, the routine will check the types itself...">A_GIMME</a>, which passes the raw list of atoms that were originally used to send the Max message in the first place. These argument type specifiers define what are known as "typed" methods in Max. Typed methods are those where Max checks the type of each atom in a message to ensure it is consistent with what the receiving object has said it expects for a given selector.<p>
If the atoms cannot be coerced into the format of the argument type specifier, a bad arguments error is printed in the Max window.<p>
There is a limit to the number of specifiers you can use, and in general, multiple <a class="el" href="group__atom.html#gg8aa6700e9f00b132eb376db6e39ade470b3aa0ab8104573dfc9cb70b5b08031f" title="32-bit float">A_FLOAT</a> specifiers should be avoided due to the historically unpredictable nature of compiler implementations when passing floating-point values on the stack. Use <a class="el" href="group__atom.html#gg8aa6700e9f00b132eb376db6e39ade4781c1a8550f038db16a619167a70a79b6" title="request that args be passed as an array, the routine will check the types itself...">A_GIMME</a> for more than four arguments or with multiple floating-point arguments.<p>
You can also specify that missing arguments to a message be filled in with default values before your C function receives them. <a class="el" href="group__atom.html#gg8aa6700e9f00b132eb376db6e39ade477bd979db3dcf86909e24a1d1452e2205" title="long but defaults to zero">A_DEFLONG</a> will put a 0 in place of a missing long argument, <a class="el" href="group__atom.html#gg8aa6700e9f00b132eb376db6e39ade4742b644240dcbb90fe67282a4d0688776" title="float, but defaults to zero">A_DEFFLOAT</a> will put 0.0 in place of a missing float argument, and <a class="el" href="group__atom.html#gg8aa6700e9f00b132eb376db6e39ade47a010616276cb89bcd04bcba611e18d51" title="symbol, defaults to &quot;&quot;">A_DEFSYM</a> will put the empty symbol (equal to gensym("")) in place of a missing symbol argument.<h2><a class="anchor" name="chapter_atoms_gimme_funcs">
Writing A_GIMME Functions</a></h2>
A method that uses <a class="el" href="group__atom.html#gg8aa6700e9f00b132eb376db6e39ade4781c1a8550f038db16a619167a70a79b6" title="request that args be passed as an array, the routine will check the types itself...">A_GIMME</a> is declared as follows: <div class="fragment"><pre class="fragment">    <span class="keywordtype">void</span> myobject_message(t_myobject *x, <a class="code" href="structt__symbol.html" title="The symbol.">t_symbol</a> *s, <span class="keywordtype">long</span> argc, <a class="code" href="structt__atom.html" title="An atom is a typed datum.">t_atom</a> *argv);
</pre></div><p>
The symbol argument s is the message selector. Ordinarily this might seem redundant, but it is useful for the "anything" method as we'll discuss below.<p>
argc is the number of atoms in the argv array. It could be 0 if the message was sent without arguments. argv is the array of atoms holding the arguments.<p>
For typed messages, the atoms will be of type <a class="el" href="group__atom.html#gg8aa6700e9f00b132eb376db6e39ade472d661c2a5d949566e2f1944c99bceeea" title="t_symbol pointer">A_SYM</a>, <a class="el" href="group__atom.html#gg8aa6700e9f00b132eb376db6e39ade470b3aa0ab8104573dfc9cb70b5b08031f" title="32-bit float">A_FLOAT</a>, or <a class="el" href="group__atom.html#gg8aa6700e9f00b132eb376db6e39ade47002f28879581a6f66ea492b994b96f1e" title="long integer">A_LONG</a>. Here is an example of a method that merely prints all of the arguments.<p>
<div class="fragment"><pre class="fragment">    <span class="keywordtype">void</span> myobject_printargs(t_myobject *x, <a class="code" href="structt__symbol.html" title="The symbol.">t_symbol</a> *s, <span class="keywordtype">long</span> argc, <a class="code" href="structt__atom.html" title="An atom is a typed datum.">t_atom</a> *argv)
    {
        <span class="keywordtype">long</span> i;
        <a class="code" href="structt__atom.html" title="An atom is a typed datum.">t_atom</a> *ap;

        <a class="code" href="group__console.html#g3714108f42b44384b4d58009eafc1806" title="Print text to the Max window.">post</a>(<span class="stringliteral">"message selector is %s"</span>,s-&gt;<a class="code" href="structt__symbol.html#07c4489eebf5e2e12d723af698347de0" title="name: a c-string">s_name</a>);
        <a class="code" href="group__console.html#g3714108f42b44384b4d58009eafc1806" title="Print text to the Max window.">post</a>(<span class="stringliteral">"there are %ld arguments"</span>,argc);
        <span class="keywordflow">for</span> (i = 0, ap = argv; i &lt; argc; i++, ap++) {       <span class="comment">// increment ap each time to get to the next atom</span>
            <span class="keywordflow">switch</span> (<a class="code" href="group__atom.html#g7959e9b765bf2eb52223587d8282a49e" title="Retrieves type from a t_atom.">atom_gettype</a>(ap)) {
                <span class="keywordflow">case</span> <a class="code" href="group__atom.html#gg8aa6700e9f00b132eb376db6e39ade47002f28879581a6f66ea492b994b96f1e" title="long integer">A_LONG</a>:
                    <a class="code" href="group__console.html#g3714108f42b44384b4d58009eafc1806" title="Print text to the Max window.">post</a>(<span class="stringliteral">"%ld: %ld"</span>,i+1,<a class="code" href="group__atom.html#g62c0a631f50db54ec654a9e40b992fe2" title="Retrieves a long integer value from a t_atom.">atom_getlong</a>(ap));
                    <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="group__atom.html#gg8aa6700e9f00b132eb376db6e39ade470b3aa0ab8104573dfc9cb70b5b08031f" title="32-bit float">A_FLOAT</a>:
                    <a class="code" href="group__console.html#g3714108f42b44384b4d58009eafc1806" title="Print text to the Max window.">post</a>(<span class="stringliteral">"%ld: %.2f"</span>,i+1,<a class="code" href="group__atom.html#g28f52239a67244db2e821320702712ca" title="Retrieves a floating point value from a t_atom.">atom_getfloat</a>(ap));
                    <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a class="code" href="group__atom.html#gg8aa6700e9f00b132eb376db6e39ade472d661c2a5d949566e2f1944c99bceeea" title="t_symbol pointer">A_SYM</a>:
                    <a class="code" href="group__console.html#g3714108f42b44384b4d58009eafc1806" title="Print text to the Max window.">post</a>(<span class="stringliteral">"%ld: %s"</span>,i+1, <a class="code" href="group__atom.html#gb43922b60c9c2aaf3a4ecabaa432ef61" title="Retrieves a t_symbol * value from a t_atom.">atom_getsym</a>(ap)-&gt;s_name);
                    <span class="keywordflow">break</span>;
                <span class="keywordflow">default</span>:
                    <a class="code" href="group__console.html#g3714108f42b44384b4d58009eafc1806" title="Print text to the Max window.">post</a>(<span class="stringliteral">"%ld: unknown atom type (%ld)"</span>, i+1, <a class="code" href="group__atom.html#g7959e9b765bf2eb52223587d8282a49e" title="Retrieves type from a t_atom.">atom_gettype</a>(ap));
                    <span class="keywordflow">break</span>;
            }
        }
    }
</pre></div><p>
You can interpret the arguments in whatever manner you wish. You cannot, however, modify the arguments as they may be about to be passed to another object. </div>
		<div id="c74footer">
			<p>Copyright &copy; 2008, <a href="http://www.cycling74.com/">Cycling '74</a></p>
		</div>
	</body>
</html>
