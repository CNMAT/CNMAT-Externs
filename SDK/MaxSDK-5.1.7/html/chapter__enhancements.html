<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
		<title>Max5 API Reference</title>
		<link href="c74-doxygen.css" rel="stylesheet" type="text/css">
	</head>
	<body>

		<div id="c74header">
			<img src="max5.png" />
			<p>Max 5 API Reference</p>
		</div>

<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="chapter_enhancements">Enhancements to Objects </a></h1><h2><a class="anchor" id="chapter_enhancements_presets">
Preset Support</a></h2>
<p>Presets are a simple state-saving mechanism. Your object receives a preset message when state is being saved. You respond by creating a message that will be sent back to your object when the preset is recalled.</p>
<p>For more powerful and general state-saving, use the pattr system described below.</p>
<p>To support saving a single integer in a preset, you can use the <a class="el" href="group__presets.html#gaf1da6073fef8e3f896602cf7f9738a23" title="Restore the state of your object with an int message.">preset_int()</a> convenience function. The <a class="el" href="group__presets.html#gaf1da6073fef8e3f896602cf7f9738a23" title="Restore the state of your object with an int message.">preset_int()</a> function records an int message with the value you pass it in the preset, to be sent back to your object at a later time.</p>
<div class="fragment"><pre class="fragment">   <a class="code" href="group__class.html#gaab2e3c25868317c8a9c216bbca2c040d" title="Adds a method to a previously defined object class.">class_addmethod</a>(c, (<a class="code" href="group__datatypes.html#gac26ba0a173b50597f5738132e059b42d" title="Function pointer type for generic methods.">method</a>)myobject_preset, <span class="stringliteral">&quot;preset&quot;</span>, 0);

   <span class="keywordtype">void</span> myobject_preset(t_myobject *x)
   {
      <a class="code" href="group__presets.html#gaf1da6073fef8e3f896602cf7f9738a23" title="Restore the state of your object with an int message.">preset_int</a>(x, x-&gt;m_currentvalue);
   }
</pre></div><p>More generally, you can use <a class="el" href="group__presets.html#ga5f6d86fdc24e371604b764e7581a4fcb" title="Give the preset object a general message to restore the current state of your object...">preset_store()</a>. Here is an example of storing two values (m_xvalue and m_yvalue) in a list. </p>
<div class="fragment"><pre class="fragment">      <a class="code" href="group__presets.html#ga5f6d86fdc24e371604b764e7581a4fcb" title="Give the preset object a general message to restore the current state of your object...">preset_store</a>(<span class="stringliteral">&quot;ossll&quot;</span>, x, ob_sym(x), <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb" title="Given a C-string, fetch the matching t_symbol pointer from the symbol table, generating...">gensym</a>(<span class="stringliteral">&quot;list&quot;</span>), x-&gt;m_xvalue, x-&gt;m_yvalue);
</pre></div><h2><a class="anchor" id="chapter_enhancements_pattr">
Pattr Support</a></h2>
<p>In most cases, you need only to define your object's state using <a class="el" href="chapter__msgattached.html#chapter_msgattached_attrs">Attributes</a> and it will be ready for use with Max's pattr system. For more complex scenarios you may also wish to investigate <a class="el" href="group__obj.html#ga6297b81c3a70f7fb2201c7262e96bba3" title="Broadcast a message (with an optional argument) from a registered object to any attached...">object_notify()</a>, <a class="el" href="group__obj.html#ga42025069e4317aef6dbe5c21c316fd85" title="Attaches a client to a registered object.">object_attach()</a>, and the section on <a class="el" href="chapter__msgattached.html#chapter_msgattached_receiving">Receiving Notifications</a>.</p>
<h2><a class="anchor" id="chapter_enhancements_assistance">
Assistance</a></h2>
<p>To show descriptions of your object's inlets and outlets while editing a patcher, your object can respond to the assist message with a function that copies the text to a string.</p>
<div class="fragment"><pre class="fragment">   <a class="code" href="group__class.html#gaab2e3c25868317c8a9c216bbca2c040d" title="Adds a method to a previously defined object class.">class_addmethod</a>(c, (<a class="code" href="group__datatypes.html#gac26ba0a173b50597f5738132e059b42d" title="Function pointer type for generic methods.">method</a>)myobject_assist, <span class="stringliteral">&quot;assist&quot;</span>, <a class="code" href="group__atom.html#gga8aa6700e9f00b132eb376db6e39ade47af48193ec36e53b1507d81c49873c8d7a" title="cannot typecheck args">A_CANT</a>, 0);
</pre></div><p>The function below has two inlets and one outlet. The io argument will be 1 for inlets, 2 for outlets. The index argument will be 0 for the leftmost inlet or outlet. You can copy a maximum of 512 characters to the output string s. You can use <a class="el" href="group__misc.html#ga0022303fac866c8f5757aa56b67ce29d" title="Copy the contents of one string to another, in a manner safer than the standard strcpy()...">strncpy_zero()</a> to copy the string, or if you want to format the assistance string based on a current value in the object, you could use <a class="el" href="group__misc.html#gab82e9c5bbc8b7fe70d16b1f6383f1cc4" title="Copy the contents of a string together with value substitutions, in a manner safer...">snprintf_zero()</a>.</p>
<div class="fragment"><pre class="fragment">   <span class="keywordtype">void</span> myobject_assist(t_myobject *x, <span class="keywordtype">void</span> *b, <span class="keywordtype">long</span> io, <span class="keywordtype">long</span> index, <span class="keywordtype">char</span> *s)
   {
      <span class="keywordflow">switch</span> (io) {
         <span class="keywordflow">case</span> 1:  
            <span class="keywordflow">switch</span> (index) {
               <span class="keywordflow">case</span> 0:
                  <a class="code" href="group__misc.html#ga0022303fac866c8f5757aa56b67ce29d" title="Copy the contents of one string to another, in a manner safer than the standard strcpy()...">strncpy_zero</a>(s, <span class="stringliteral">&quot;This is a description of the leftmost inlet&quot;</span>, 512);
                  <span class="keywordflow">break</span>;
               <span class="keywordflow">case</span> 1: 
                  <a class="code" href="group__misc.html#ga0022303fac866c8f5757aa56b67ce29d" title="Copy the contents of one string to another, in a manner safer than the standard strcpy()...">strncpy_zero</a>(s, <span class="stringliteral">&quot;This is a description of the rightmost inlet&quot;</span>, 512);
                  <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> 2:
            <a class="code" href="group__misc.html#ga0022303fac866c8f5757aa56b67ce29d" title="Copy the contents of one string to another, in a manner safer than the standard strcpy()...">strncpy_zero</a>(s, <span class="stringliteral">&quot;This is a description of the outlet&quot;</span>, 512);
            <span class="keywordflow">break</span>;
      }
   }
</pre></div><h2><a class="anchor" id="chapter_enhancements_hotness">
Hot and Cold Inlets</a></h2>
<p>Objects such as operators (+, -, etc.) and the int object have inlets that merely store values rather than performing an operation and producing output. These inlets are labeled with a blue color to indicate they are "cold" rather than action-producing "hot" inlets. To implement this labeling, your object can respond to the inletinfo message.</p>
<div class="fragment"><pre class="fragment">      <a class="code" href="group__class.html#gaab2e3c25868317c8a9c216bbca2c040d" title="Adds a method to a previously defined object class.">class_addmethod</a>(c, (<a class="code" href="group__datatypes.html#gac26ba0a173b50597f5738132e059b42d" title="Function pointer type for generic methods.">method</a>)myobject_inletinfo, <span class="stringliteral">&quot;inletinfo&quot;</span>, <a class="code" href="group__atom.html#gga8aa6700e9f00b132eb376db6e39ade47af48193ec36e53b1507d81c49873c8d7a" title="cannot typecheck args">A_CANT</a>, 0);
</pre></div><p>If all of your object's non-left inlets are "cold" you can use the function stdinletinfo() instead of writing your own, as shown below: </p>
<div class="fragment"><pre class="fragment">      <a class="code" href="group__class.html#gaab2e3c25868317c8a9c216bbca2c040d" title="Adds a method to a previously defined object class.">class_addmethod</a>(c, (<a class="code" href="group__datatypes.html#gac26ba0a173b50597f5738132e059b42d" title="Function pointer type for generic methods.">method</a>)stdinletinfo, <span class="stringliteral">&quot;inletinfo&quot;</span>, <a class="code" href="group__atom.html#gga8aa6700e9f00b132eb376db6e39ade47af48193ec36e53b1507d81c49873c8d7a" title="cannot typecheck args">A_CANT</a>, 0);
</pre></div><p>To write your own function, just look at the index argument (which is 0 for the left inlet). This example turns the third inlet cold. You don't need to do anything for "hot" inlets.</p>
<div class="fragment"><pre class="fragment">   <span class="keywordtype">void</span> myobject_inletinfo(t_myobject *x, <span class="keywordtype">void</span> *b, <span class="keywordtype">long</span> index, <span class="keywordtype">char</span> *t)
   {
      <span class="keywordflow">if</span> (index == 2)
         *t = 1;
   }
</pre></div><h2><a class="anchor" id="chapter_enhancements_ed">
Showing a Text Editor</a></h2>
<p>Objects such as coll and text display a text editor window when you double-click. Users can edit the contents of the objects and save the updated data (or not). Here's how to do the same thing in your object.</p>
<p>First, if you want to support double-clicking on a non-UI object, you can respond to the dblclick message.</p>
<div class="fragment"><pre class="fragment">   <a class="code" href="group__class.html#gaab2e3c25868317c8a9c216bbca2c040d" title="Adds a method to a previously defined object class.">class_addmethod</a>(c, (<a class="code" href="group__datatypes.html#gac26ba0a173b50597f5738132e059b42d" title="Function pointer type for generic methods.">method</a>)myobject_dblclick, <span class="stringliteral">&quot;dblclick&quot;</span>, <a class="code" href="group__atom.html#gga8aa6700e9f00b132eb376db6e39ade47af48193ec36e53b1507d81c49873c8d7a" title="cannot typecheck args">A_CANT</a>, 0);

   <span class="keywordtype">void</span> myobject_dblclick(t_myobject *x)
   {
      <span class="comment">// open editor here</span>
   }
</pre></div><p>You'll need to add a <a class="el" href="structt__object.html" title="The structure for the head of any object which wants to have inlets or outlets, or...">t_object</a> pointer to your object's data structure to hold the editor.</p>
<div class="fragment"><pre class="fragment">   <span class="keyword">typedef</span> <span class="keyword">struct </span>_myobject
   {
      <a class="code" href="structt__object.html" title="The structure for the head of any object which wants to have inlets or outlets, or...">t_object</a> m_obj;
      <a class="code" href="structt__object.html" title="The structure for the head of any object which wants to have inlets or outlets, or...">t_object</a> *m_editor;
   } t_myobject;
</pre></div><p>Initialize the m_editor field to NULL in your new instance routine. Then implement the dblclick method as follows: </p>
<div class="fragment"><pre class="fragment">      <span class="keywordflow">if</span> (!x-&gt;m_editor)
         x-&gt;m_editor = <a class="code" href="group__obj.html#gac4b370265c776db4f545d257089af1cf" title="Allocates the memory for an instance of an object class and initialize its object...">object_new</a>(<a class="code" href="group__class.html#ga090d3cbc4f137661806fc1b72249a791" title="A namespace for creating hidden or internal object classes which are not a direct...">CLASS_NOBOX</a>, <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb" title="Given a C-string, fetch the matching t_symbol pointer from the symbol table, generating...">gensym</a>(<span class="stringliteral">&quot;jed&quot;</span>), (<a class="code" href="structt__object.html" title="The structure for the head of any object which wants to have inlets or outlets, or...">t_object</a> *)x, 0);
      <span class="keywordflow">else</span>
         object_attr_setchar(x-&gt;m_editor, <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb" title="Given a C-string, fetch the matching t_symbol pointer from the symbol table, generating...">gensym</a>(<span class="stringliteral">&quot;visible&quot;</span>), 1);
</pre></div><p>The code above does the following: If the editor does not exist, we create one by making a "jed" object and passing our object as an argument. This permits the editor to tell our object when the window is closed.</p>
<p>If the editor does exist, we set its visible attribute to 1, which brings the text editor window to the front.</p>
<p>To set the text of the edit window, we can send our jed object the settext message with a zero-terminated buffer of text. We also provide a symbol specifying how the text is encoded. For best results, the text should be encoded as UTF-8. Here is an example where we set a string to contain "Some text to edit" then pass it to the editor.</p>
<div class="fragment"><pre class="fragment">         <span class="keywordtype">char</span> text[512];

         strcpy(text,<span class="stringliteral">&quot;Some text to edit&quot;</span>);
         <a class="code" href="group__obj.html#gae740749094827ac5adc2b7145db1c596" title="Sends an untyped message to an object.">object_method</a>(x-&gt;m_editor, <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb" title="Given a C-string, fetch the matching t_symbol pointer from the symbol table, generating...">gensym</a>(<span class="stringliteral">&quot;settext&quot;</span>), text, <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb" title="Given a C-string, fetch the matching t_symbol pointer from the symbol table, generating...">gensym</a>(<span class="stringliteral">&quot;utf-8&quot;</span>)); 
</pre></div><p>The title attribute sets the window title of the text editor. </p>
<div class="fragment"><pre class="fragment">         <a class="code" href="group__attr.html#ga642c3b5686b08880194f74c0d5149bcf" title="Sets the value of an attribute, given its parent object and name.">object_attr_setsym</a>(x-&gt;m_editor, <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb" title="Given a C-string, fetch the matching t_symbol pointer from the symbol table, generating...">gensym</a>(<span class="stringliteral">&quot;title&quot;</span>), <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb" title="Given a C-string, fetch the matching t_symbol pointer from the symbol table, generating...">gensym</a>(<span class="stringliteral">&quot;crazytext&quot;</span>));
</pre></div><p>When the user closes the text window, your object (or the object you passed as an argument when creating the editor) will be sent the edclose message. </p>
<div class="fragment"><pre class="fragment">         <a class="code" href="group__class.html#gaab2e3c25868317c8a9c216bbca2c040d" title="Adds a method to a previously defined object class.">class_addmethod</a>(c, (<a class="code" href="group__datatypes.html#gac26ba0a173b50597f5738132e059b42d" title="Function pointer type for generic methods.">method</a>)myobject_edclose, <span class="stringliteral">&quot;edclose&quot;</span>, <a class="code" href="group__atom.html#gga8aa6700e9f00b132eb376db6e39ade47af48193ec36e53b1507d81c49873c8d7a" title="cannot typecheck args">A_CANT</a>, 0);
</pre></div><p>The edclose method is responsible for doing something with the text. It should also zero the reference to the editor stored in the object, because it will be freed. A pointer to the text pointer is passed, along with its size. The encoding of the text is always UTF-8.</p>
<div class="fragment"><pre class="fragment">   <span class="keywordtype">void</span> myobject_edclose(t_myobject *x, <span class="keywordtype">char</span> **ht, <span class="keywordtype">long</span> size)
   {
      <span class="comment">// do something with the text</span>
      x-&gt;m_editor = NULL;
   }
</pre></div><p>If your object will be showing the contents of a text file, you are still responsible for setting the initial text, but you can assign a file so that the editor will save the text data when the user chooses Save from the File menu. To assign a file, use the filename message, assuming you have a filename and path ID.</p>
<div class="fragment"><pre class="fragment">      <a class="code" href="group__obj.html#gae740749094827ac5adc2b7145db1c596" title="Sends an untyped message to an object.">object_method</a>(x-&gt;m_editor, <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb" title="Given a C-string, fetch the matching t_symbol pointer from the symbol table, generating...">gensym</a>(<span class="stringliteral">&quot;filename&quot;</span>), x-&gt;m_myfilename, x-&gt;m_mypath);
</pre></div><p>The filename message will set the title of the text editor window, but you can use the title attribute to override the simple filename. For example, you might want the name of your object to precede the filename: </p>
<div class="fragment"><pre class="fragment">      <span class="keywordtype">char</span> titlename[512];

      sprintf(titlename, <span class="stringliteral">&quot;myobject: %s&quot;</span>, x-&gt;m_myfilename);
      <a class="code" href="group__attr.html#ga642c3b5686b08880194f74c0d5149bcf" title="Sets the value of an attribute, given its parent object and name.">object_attr_setsym</a>(x-&gt;m_editor, <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb" title="Given a C-string, fetch the matching t_symbol pointer from the symbol table, generating...">gensym</a>(<span class="stringliteral">&quot;title&quot;</span>), <a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb" title="Given a C-string, fetch the matching t_symbol pointer from the symbol table, generating...">gensym</a>(titlename));
</pre></div><p>Each time the user chooses Save, your object will receive an edsave message. If you return zero from your edsave method, the editor will proceed with saving the text in a file. If you return non-zero, the editor assumes you have taken care of saving the text. The general idea is that when the user wants to save the text, it is either updated inside your object, updated in a file, or both. As an example, the js object uses its edsave message to trigger a recompile of the Javascript code. But it also returns 0 from its edsave method so that the text editor will update the script file. Except for the return value, the prototype of the edsave method is identical to the edclose method.</p>
<div class="fragment"><pre class="fragment">   <a class="code" href="group__class.html#gaab2e3c25868317c8a9c216bbca2c040d" title="Adds a method to a previously defined object class.">class_addmethod</a>(c, (<a class="code" href="group__datatypes.html#gac26ba0a173b50597f5738132e059b42d" title="Function pointer type for generic methods.">method</a>)myobject_edsave, <span class="stringliteral">&quot;edsave&quot;</span>, <a class="code" href="group__atom.html#gga8aa6700e9f00b132eb376db6e39ade47af48193ec36e53b1507d81c49873c8d7a" title="cannot typecheck args">A_CANT</a>, 0);

   <span class="keywordtype">long</span> myobject_edsave(t_myobject *x, <span class="keywordtype">char</span> **ht, <span class="keywordtype">long</span> size)
   {
      <span class="comment">// do something with the text</span>
      <span class="keywordflow">return</span> 0;      <span class="comment">// tell editor it can save the text</span>
   }
</pre></div><h2><a class="anchor" id="chapter_enhancements_tables">
Accessing Data in table Objects</a></h2>
<p>Table objects can be given names as arguments. If a table object has a name, you can access the data using <a class="el" href="group__tables.html#ga2c08d1383a235eb8c106c0f3afea6d21" title="Get a handle to the data in a named table object.">table_get()</a>. Supply a symbol, as well as a place to assign a pointer to the data and the length. The following example accesses a table called foo, and, if found, posts all its values.</p>
<div class="fragment"><pre class="fragment">   <span class="keywordtype">long</span> **data = NULL;
   <span class="keywordtype">long</span> i, size;

      <span class="keywordflow">if</span> (!<a class="code" href="group__tables.html#ga2c08d1383a235eb8c106c0f3afea6d21" title="Get a handle to the data in a named table object.">table_get</a>(<a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb" title="Given a C-string, fetch the matching t_symbol pointer from the symbol table, generating...">gensym</a>(<span class="stringliteral">&quot;foo&quot;</span>), &amp;data, &amp;size)) {
         <span class="keywordflow">for</span> (i = 0;  i &lt; size; i++) {
            <a class="code" href="group__console.html#ga8eebb1400d598f4423f925102d02970a" title="Print text to the Max window.">post</a>(<span class="stringliteral">&quot;%ld: %ld&quot;</span>,i,(*data)[i]);
         }
      }
</pre></div><p>You can also write data into the table. If you would like the table editor to redraw after doing so, use <a class="el" href="group__tables.html#gaa72449d4792a6108489ef63c5f5ba7a3" title="Mark a table object as having changed data.">table_dirty()</a>. Here's an example where we set all values in the table to zero, then notify the table to redraw.</p>
<div class="fragment"><pre class="fragment">   <span class="keywordtype">long</span> **data = NULL;
   <span class="keywordtype">long</span> i, size;

      <span class="keywordflow">if</span> (!<a class="code" href="group__tables.html#ga2c08d1383a235eb8c106c0f3afea6d21" title="Get a handle to the data in a named table object.">table_get</a>(<a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb" title="Given a C-string, fetch the matching t_symbol pointer from the symbol table, generating...">gensym</a>(<span class="stringliteral">&quot;foo&quot;</span>), &amp;data, &amp;size)) {
         <span class="keywordflow">for</span> (i = 0;  i &lt; size; i++) {
            (*data)[i]  = 0;
         }
         <a class="code" href="group__tables.html#gaa72449d4792a6108489ef63c5f5ba7a3" title="Mark a table object as having changed data.">table_dirty</a>(<a class="code" href="group__symbol.html#ga5d8db08b384aeb76eaee85a15f46fbcb" title="Given a C-string, fetch the matching t_symbol pointer from the symbol table, generating...">gensym</a>(<span class="stringliteral">&quot;foo&quot;</span>));
      }
</pre></div><p>buffer~ support </p>
</div>
		<div id="c74footer">
			<p>Copyright &copy; 2008, <a href="http://www.cycling74.com/">Cycling '74</a></p>
		</div>
	</body>
</html>
