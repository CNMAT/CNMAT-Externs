<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Max 6 API</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
	<div id="c74header">
		<img src="header.png" height="200" />
	</div>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('chapter_jit_jxf.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">JXF File Specification </div>  </div>
</div>
<div class="contents">
<div class="textblock"><p>The Jitter File Format (JXF) stores matrix data in a binary (not human-readable) form.</p>
<p>When using Jitter you can create JXF files by sending the write message to a jit.matrix object. Conversely you can read JXF files from disk using the read message. This section will cover first the API functions that one can use from C to read and write JXF files. Then it will break down the file format at the bit level.</p>
<h2><a class="anchor" id="chapter_jit_jxf_api"></a>
The Binary JXF API</h2>
<p>Most Jitter users do not need or want to know about the internal binary format of a JXF-file. Even users who want to read and write JXF-files from C do not need to know the internal details if they use the functions of the Jitter API for the binary interface. Not only is the API more convenient, but using the functions provided by Cycling '74 may protect your code from having to be altered in the future in the event of a specification change.</p>
<p>There are two primary functions one should use to read data from a JXF file. <a class="el" href="group__binmod.html#gae7d8bcde80fd16666ab01a841f0f23b2" title="Reads the header of a JXF binary file.">jit_bin_read_header()</a> reads the version number and the size of the file from the header, and has the following signature:</p>
<div class="fragment"><pre class="fragment">t_jit_err <a class="code" href="group__binmod.html#gae7d8bcde80fd16666ab01a841f0f23b2" title="Reads the header of a JXF binary file.">jit_bin_read_header</a>(<a class="code" href="group__files.html#gafcb776aa74d514754e83b30995b5a5d1" title="A t_filehandle is a cross-platform way of referring to an open file.">t_filehandle</a> fh, <a class="code" href="group__datatypes.html#ga718b4eb2652c286f4d42dc18a8e71a1a" title="An unsigned long integer.">ulong</a> *version, <span class="keywordtype">long</span> *filesize)
</pre></div><p><a class="el" href="group__binmod.html#gae1bd457360f302d87be427c0bcf76b9d" title="Reads matrix data from a JXF binary file.">jit_bin_read_matrix()</a> imports matrix data from a file to a matrix, resizing the matrix if necessary, and has the following signature:</p>
<div class="fragment"><pre class="fragment">t_jit_err <a class="code" href="group__binmod.html#gae1bd457360f302d87be427c0bcf76b9d" title="Reads matrix data from a JXF binary file.">jit_bin_read_matrix</a>(<a class="code" href="group__files.html#gafcb776aa74d514754e83b30995b5a5d1" title="A t_filehandle is a cross-platform way of referring to an open file.">t_filehandle</a> fh, <span class="keywordtype">void</span> *matrix)
</pre></div><p>Here’s a chunk of code that shows how to read a matrix from disk:</p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">if</span> (!(err=<a class="code" href="group__files.html#ga6c687155c75742612024b403d7010ae4" title="Open a file given a filename and Path ID.">path_opensysfile</a>(filename, path, &amp;fh, READ_PERM))) {
   <span class="comment">//all is well</span>
} <span class="keywordflow">else</span> {
   <a class="code" href="group__console.html#ga8a87d2e25431900a88722759ec115757" title="Print an error to the Max window.">error</a>(<span class="stringliteral">&quot;jit.matrix: can&#39;t open file %s&quot;</span>,name-&gt;<a class="code" href="structt__symbol.html#ae2bf70cea045897c171f39116bf536c8" title="name: a c-string">s_name</a>);
   <span class="keywordflow">goto</span> out;
}
<span class="keywordflow">if</span> (<a class="code" href="group__binmod.html#gae7d8bcde80fd16666ab01a841f0f23b2" title="Reads the header of a JXF binary file.">jit_bin_read_header</a>(fh,&amp;version,&amp;filesize)) {
   <a class="code" href="group__console.html#ga8a87d2e25431900a88722759ec115757" title="Print an error to the Max window.">error</a>(<span class="stringliteral">&quot;jit.matrix: improper file format %s&quot;</span>,name-&gt;<a class="code" href="structt__symbol.html#ae2bf70cea045897c171f39116bf536c8" title="name: a c-string">s_name</a>);
   <a class="code" href="group__files.html#gad17b977bcb191648c2856d589c45f0d4" title="Close a file opened with sysfile_open().">sysfile_close</a>(fh);
   <span class="keywordflow">goto</span> out;
}
<span class="keywordflow">if</span> (<a class="code" href="group__binmod.html#gae1bd457360f302d87be427c0bcf76b9d" title="Reads matrix data from a JXF binary file.">jit_bin_read_matrix</a>(fh,matrix)) {
   <a class="code" href="group__console.html#ga8a87d2e25431900a88722759ec115757" title="Print an error to the Max window.">error</a>(<span class="stringliteral">&quot;jit.matrix: improper file format %s&quot;</span>,name-&gt;<a class="code" href="structt__symbol.html#ae2bf70cea045897c171f39116bf536c8" title="name: a c-string">s_name</a>);
   <a class="code" href="group__files.html#gad17b977bcb191648c2856d589c45f0d4" title="Close a file opened with sysfile_open().">sysfile_close</a>(fh);
   <span class="keywordflow">goto</span> out;
}
<a class="code" href="group__files.html#gad17b977bcb191648c2856d589c45f0d4" title="Close a file opened with sysfile_open().">sysfile_close</a>(fh);
</pre></div><p>Similarly there are two functions one should use when writing data to a JXF file. <a class="el" href="group__binmod.html#ga01de67893378a46116aef0fbb36b5b33" title="Writes the header of a JXF binary file.">jit_bin_write_header()</a> writes a header to a file, and has the following signature:</p>
<div class="fragment"><pre class="fragment">t_jit_err <a class="code" href="group__binmod.html#ga01de67893378a46116aef0fbb36b5b33" title="Writes the header of a JXF binary file.">jit_bin_write_header</a>(<a class="code" href="group__files.html#gafcb776aa74d514754e83b30995b5a5d1" title="A t_filehandle is a cross-platform way of referring to an open file.">t_filehandle</a> fh, <span class="keywordtype">long</span> filesize)
</pre></div><p><a class="el" href="group__binmod.html#ga8102ed7929a540a5584505049870887a" title="Writes a matrix to a JXF binary file.">jit_bin_write_matrix()</a> writes a matrix to a file, and has the following signature:</p>
<div class="fragment"><pre class="fragment">t_jit_err <a class="code" href="group__binmod.html#ga8102ed7929a540a5584505049870887a" title="Writes a matrix to a JXF binary file.">jit_bin_write_matrix</a>(<a class="code" href="group__files.html#gafcb776aa74d514754e83b30995b5a5d1" title="A t_filehandle is a cross-platform way of referring to an open file.">t_filehandle</a> fh, <span class="keywordtype">void</span> *matrix)
</pre></div><p>Here’s a section of code that shows how you might write a file with one matrix. Note that the initial filesize argument to <a class="el" href="group__binmod.html#ga01de67893378a46116aef0fbb36b5b33" title="Writes the header of a JXF binary file.">jit_bin_write_header()</a> is bogus, but that the header is written again at the end of the operation when the filesize can be determined from the file position after writing the matrix.</p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">if</span> (err=<a class="code" href="group__files.html#ga448e48ee3fb4b593c698e41bec7f9c0a" title="Create a file given a type code, a filename, and a Path ID.">path_createsysfile</a>(filename, path, type, &amp;fh)) {
   <a class="code" href="group__console.html#ga8a87d2e25431900a88722759ec115757" title="Print an error to the Max window.">error</a>(<span class="stringliteral">&quot;jit.matrix: could not create file %s&quot;</span>,name-&gt;<a class="code" href="structt__symbol.html#ae2bf70cea045897c171f39116bf536c8" title="name: a c-string">s_name</a>);
   <span class="keywordflow">goto</span> out;
}
<span class="keywordflow">if</span> (<a class="code" href="group__binmod.html#ga01de67893378a46116aef0fbb36b5b33" title="Writes the header of a JXF binary file.">jit_bin_write_header</a>(fh,0)) {
   <a class="code" href="group__console.html#ga8a87d2e25431900a88722759ec115757" title="Print an error to the Max window.">error</a>(<span class="stringliteral">&quot;jit.matrix: could not write header %s&quot;</span>, matrixName-&gt;s_name);
   <a class="code" href="group__files.html#gad17b977bcb191648c2856d589c45f0d4" title="Close a file opened with sysfile_open().">sysfile_close</a>(fh);
   <span class="keywordflow">goto</span> out;
}
<span class="keywordflow">if</span> (<a class="code" href="group__binmod.html#ga8102ed7929a540a5584505049870887a" title="Writes a matrix to a JXF binary file.">jit_bin_write_matrix</a>(fh,pointerToMatrix)) {
   <a class="code" href="group__console.html#ga8a87d2e25431900a88722759ec115757" title="Print an error to the Max window.">error</a>(<span class="stringliteral">&quot;jit.matrix: could not write matrix %s&quot;</span>, matrixName-&gt;s_name);
   <a class="code" href="group__files.html#gad17b977bcb191648c2856d589c45f0d4" title="Close a file opened with sysfile_open().">sysfile_close</a>(fh);
   <span class="keywordflow">goto</span> out;
}
<a class="code" href="group__files.html#ga01c1a63930d986e9661efe25ddbdecd6" title="Get the current file position of a file handle.">sysfile_getpos</a>(fh, &amp;position);
<a class="code" href="group__files.html#ga6f17a82aafd0afdf89612b8d4c123f6d" title="Set the size of a file handle.">sysfile_seteof</a>(fh, position);
<span class="keywordflow">if</span> (<a class="code" href="group__binmod.html#ga01de67893378a46116aef0fbb36b5b33" title="Writes the header of a JXF binary file.">jit_bin_write_header</a>(fh,position)) {
   <a class="code" href="group__console.html#ga8a87d2e25431900a88722759ec115757" title="Print an error to the Max window.">error</a>(<span class="stringliteral">&quot;jit.matrix: could not write header %s&quot;</span>,
matrixName-&gt;s_name);
   <a class="code" href="group__files.html#gad17b977bcb191648c2856d589c45f0d4" title="Close a file opened with sysfile_open().">sysfile_close</a>(fh);
   <span class="keywordflow">goto</span> out;
}
<a class="code" href="group__files.html#gad17b977bcb191648c2856d589c45f0d4" title="Close a file opened with sysfile_open().">sysfile_close</a>(fh);
</pre></div><h2><a class="anchor" id="chapter_jit_jxf_spec"></a>
Specification of the JXF Format</h2>
<p>The internal format of JXF-files is based on the Interchange File Format (IFF) (<a href="http://en.wikipedia.org/wiki/Interchange_File_Format">http://en.wikipedia.org/wiki/Interchange_File_Format</a>). An IFF file is built up from chunks. All data in IFF files is big-endian. Several convenience macros defined in jit.byteorder.h are available to help convert numbers to the proper format before and after they're written to and read from a JXF <a href="file:">file:</a> BE_I32() can be called on 32-bit integers, BE_F32() on 32-bit floats, and BE_F64() on 64-bit doubles.</p>
<p>Each chunk in an IFF file begins with a four character Type ID. This is followed by a 32-bit unsigned integer specifying the size of the chunk content in bytes. In a JXF file, the 32-bit integer part of the first chunk tells us the size of the file, and all the subsequent chunks, which begin immediately after the first chunk, contain matrices. In the future chunks may also be used to store other kinds of data.</p>
<p>Here is a tabular overview of an example minimal JXF file.</p>
<p>Container Chunk</p>
<table class="doxtable">
<tr>
<td>groupID </td><td>JIT_BIN_CHUNK_CONTAINER ('FORM')  </td></tr>
<tr>
<td>File size </td><td>32-bit int  </td></tr>
<tr>
<td>IFF Type </td><td>JIT_BIN_FORMAT ('JIT!')  </td></tr>
<tr>
<td>Format Chunk </td></tr>
<tr>
<td></td></tr>
<tr>
<td>chunkID </td><td>JIT_BIN_CHUNK_FORMAT_VERSION ('FVER')  </td></tr>
<tr>
<td>Chunk size </td><td>12 bytes  </td></tr>
<tr>
<td>Version </td><td>JIT_BIN_VERSION_1 (0x3C93DC80)  </td></tr>
<tr>
<td>Matrix Chunk </td><td></td></tr>
<tr>
<td>chunk ID </td><td>JIT_BIN_CHUNK_MATRIX ('MTRX')  </td></tr>
<tr>
<td>chunk size </td><td>32-bit int  </td></tr>
<tr>
<td>offset </td><td>32-bit int  </td></tr>
<tr>
<td>type </td><td>4-char  </td></tr>
<tr>
<td>planecount </td><td>32-bit int  </td></tr>
<tr>
<td>dimcount </td><td>32-bit int  </td></tr>
<tr>
<td>dim </td><td>Array of 32-bit ints that contain the dimensions  </td></tr>
<tr>
<td>data </td><td></td></tr>
</table>
<p>The data offset of the matrix chunk represents the offset, in bytes, from the beginning of the chunk to the beginning of the data portion of the chunk. The type is one of CHAR, LONG, FL32 and FL64. The dim array contains dimcount elements, each of which is a 32-bit int. The data portion consists of the cells of the matrix written out one at a time in row-major order. Planar data is multiplexed in each cell. For example, a 3-plane 2 by 2 matrix would be written out in the following order:</p>
<table class="doxtable">
<tr>
<td>Plane </td><td>Dim 0 </td><td>Dim 1  </td></tr>
<tr>
<td>0 </td><td>0 </td><td>0  </td></tr>
<tr>
<td>1 </td><td>0 </td><td>0  </td></tr>
<tr>
<td>2 </td><td>0 </td><td>0  </td></tr>
<tr>
<td>0 </td><td>1 </td><td>0  </td></tr>
<tr>
<td>1 </td><td>1 </td><td>0  </td></tr>
<tr>
<td>2 </td><td>1 </td><td>0  </td></tr>
<tr>
<td>0 </td><td>0 </td><td>1  </td></tr>
<tr>
<td>1 </td><td>0 </td><td>1  </td></tr>
<tr>
<td>2 </td><td>0 </td><td>1  </td></tr>
<tr>
<td>0 </td><td>1 </td><td>1  </td></tr>
<tr>
<td>1 </td><td>1 </td><td>1  </td></tr>
<tr>
<td>2 </td><td>1 </td><td>1  </td></tr>
</table>
<p>The various chunks discussed above can be represented by the C structs listed below:</p>
<div class="fragment"><pre class="fragment"><span class="keyword">typedef</span> <span class="keyword">struct </span>_jit_bin_chunk_container
{
   <a class="code" href="group__datatypes.html#ga718b4eb2652c286f4d42dc18a8e71a1a" title="An unsigned long integer.">ulong</a>   ckid;       <span class="comment">//&#39;FORM&#39;</span>
   <span class="keywordtype">long</span>   cksize;      <span class="comment">//filesize</span>
   <a class="code" href="group__datatypes.html#ga718b4eb2652c286f4d42dc18a8e71a1a" title="An unsigned long integer.">ulong</a>   formtype;   <span class="comment">//&#39;JIT!&#39;</span>
} t_jit_bin_chunk_container;

<span class="keyword">typedef</span> <span class="keyword">struct </span>_jit_bin_chunk_format_version
{
   <a class="code" href="group__datatypes.html#ga718b4eb2652c286f4d42dc18a8e71a1a" title="An unsigned long integer.">ulong</a>   ckid;       <span class="comment">//&#39;FVER&#39;</span>
   <span class="keywordtype">long</span>   cksize;      <span class="comment">//12</span>
   <a class="code" href="group__datatypes.html#ga718b4eb2652c286f4d42dc18a8e71a1a" title="An unsigned long integer.">ulong</a>   vers;      <span class="comment">//timestamp</span>
} t_jit_bin_chunk_format_version;

<span class="keyword">typedef</span> <span class="keyword">struct </span>_jit_bin_chunk_matrix
{
   <a class="code" href="group__datatypes.html#ga718b4eb2652c286f4d42dc18a8e71a1a" title="An unsigned long integer.">ulong</a>   ckid;       <span class="comment">//&#39;MTRX&#39;</span>
   <span class="keywordtype">long</span>   cksize;      <span class="comment">//varies(should be equal to </span>
               <span class="comment">//24+(4*dimcount)+(typesize*planecount*totalpoints))</span>
   <span class="keywordtype">long</span>    offset;      <span class="comment">//data offset(should be equal to 24+(4*dimcount))</span>
   <a class="code" href="group__datatypes.html#ga718b4eb2652c286f4d42dc18a8e71a1a" title="An unsigned long integer.">ulong</a>   type;      <span class="comment">//&#39;CHAR&#39;,&#39;LONG&#39;,&#39;FL32&#39;,&#39;FL64&#39;</span>
   <span class="keywordtype">long</span>   planecount;
   <span class="keywordtype">long</span>   dimcount;
   <span class="keywordtype">long</span>   dim[1];
} t_jit_bin_chunk_matrix;
</pre></div> </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

		<div id="c74footer">
			&nbsp;&nbsp;Copyright &copy; 2011, <a href="http://www.cycling74.com/">Cycling '74</a>
		</div>
	</body>
</html>
